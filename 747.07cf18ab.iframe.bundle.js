/*! For license information please see 747.07cf18ab.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkcool_cats_ui=self.webpackChunkcool_cats_ui||[]).push([[747],{"./src/Avatar/types.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{IM:()=>AvatarView,K3:()=>TraitType,df:()=>TraitRuleFunction,n6:()=>TraitRuleType,qE:()=>Avatar,un:()=>TraitRarity});let Avatar=function(Avatar){return Avatar.CAT="CAT",Avatar.SHADOWWOLF="SHADOWWOLF",Avatar.EXPLORER="EXPLORER",Avatar.NONE="NONE",Avatar}({}),AvatarView=function(AvatarView){return AvatarView.FRONT="FRONT",AvatarView.RIGHT="RIGHT",AvatarView.FULL="FULL",AvatarView.LEFT="LEFT",AvatarView.HEAD="HEAD",AvatarView}({}),TraitType=function(TraitType){return TraitType.BACKGROUND="BACKGROUND",TraitType.BODY="BODY",TraitType.BACK="BACK",TraitType.SKIN="SKIN",TraitType.SHIRT="SHIRT",TraitType.FACE="FACE",TraitType.HAT="HAT",TraitType.PANTS="PANTS",TraitType.SHOES="SHOES",TraitType.EFFECT="EFFECT",TraitType.BORDER="BORDER",TraitType.ACCESSORY="ACCESSORY",TraitType.SIDEKICK="SIDEKICK",TraitType}({}),TraitRuleType=function(TraitRuleType){return TraitRuleType.FILTER="FILTER",TraitRuleType.MUTATE="MUTATE",TraitRuleType.MUTATE_ALL="MUTATE_ALL",TraitRuleType.MUTATE_LAYERS="MUTATE_LAYERS",TraitRuleType.EFFECT="EFFECT",TraitRuleType}({}),TraitRarity=function(TraitRarity){return TraitRarity[TraitRarity.NONE=0]="NONE",TraitRarity[TraitRarity.COMMON=1]="COMMON",TraitRarity[TraitRarity.UNCOMMON=2]="UNCOMMON",TraitRarity[TraitRarity.RARE=3]="RARE",TraitRarity[TraitRarity.EPIC=4]="EPIC",TraitRarity[TraitRarity.LEGENDARY=5]="LEGENDARY",TraitRarity}({}),TraitRuleFunction=function(TraitRuleFunction){return TraitRuleFunction.HIDE_VISOR="HIDE_VISOR",TraitRuleFunction.EFFECT_BLACK_AND_WHITE="EFFECT_BLACK_AND_WHITE",TraitRuleFunction.EFFECT_OUTLINE="EFFECT_OUTLINE",TraitRuleFunction.EFFECT_INVERSE="EFFECT_INVERSE",TraitRuleFunction.MOVE_PANTS_UNDER_SHIRT="MOVE_PANTS_UNDER_SHIRT",TraitRuleFunction.MOVE_PANTS_OVER_SHIRT="MOVE_PANTS_OVER_SHIRT",TraitRuleFunction.MOVE_SHIRTS_OVER_HATS="MOVE_SHIRTS_OVER_HATS",TraitRuleFunction.EFFECT_UPSIDE_DOWN="EFFECT_UPSIDE_DOWN",TraitRuleFunction.EFFECT_FLIP_HORIZONTAL="EFFECT_FLIP_HORIZONTAL",TraitRuleFunction.FLIP_SIDEKICK="FLIP_SIDEKICK",TraitRuleFunction.FLIP_ACCESSORY="FLIP_ACCESSORY",TraitRuleFunction.EFFECT_OUTLINE_LEFT_CAT="EFFECT_OUTLINE_LEFT_CAT",TraitRuleFunction.COMIC_CON_PLACEMENT="COMIC_CON_PLACEMENT",TraitRuleFunction.HOMER_NFT_PLACEMENT="HOMER_NFT_PLACEMENT",TraitRuleFunction.CABAL_PLACEMENT="CABAL_PLACEMENT",TraitRuleFunction.CHRISTMAS_CARD_PLACEMENT="CHRISTMAS_CARD_PLACEMENT",TraitRuleFunction.HIDE_FACE_FOR_MECHANICAL="HIDE_FACE_FOR_MECHANICAL",TraitRuleFunction.HIDE_LEGS_AND_FEET="HIDE_LEGS_AND_FEET",TraitRuleFunction.WOOT_PLACEMENT="WOOT_PLACEMENT",TraitRuleFunction.MILK_CHUG="MILK_CHUG",TraitRuleFunction.EFFECT_STICKER="EFFECT_STICKER",TraitRuleFunction.EFFECT_SEPIA="EFFECT_SEPIA",TraitRuleFunction.HIDE_ARMS="HIDE_ARMS",TraitRuleFunction.HIDE_CHEEKS="HIDE_CHEEKS",TraitRuleFunction.HAT_MUTATION="HAT_MUTATION",TraitRuleFunction}({})},"./src/AvatarCanvas/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>src_AvatarCanvas});var react=__webpack_require__("./node_modules/react/index.js"),LayeredCanvas=__webpack_require__("./src/LayeredCanvas/index.tsx"),types=__webpack_require__("./src/Avatar/types.ts");const EFFECT_OUTLINE_PARENT=(canvas,ctx,r,g,b)=>{const imgData=ctx.getImageData(0,0,canvas.width,canvas.height),{data}=imgData;for(let i=0;i<data.length;i+=4)r.includes(data[i+0])||g.includes(data[i+1])||b.includes(data[i+2])||(data[i+0]=255,data[i+1]=255,data[i+2]=255);ctx.putImageData(imgData,0,0)},Sr=[0,0,0,1,1,2,3,3,3,4,4,4,5,5,5,6,6,7,7,7,7,8,8,8,9,9,9,9,10,10,10,10,11,11,12,12,12,12,13,13,13,14,14,15,15,16,16,17,17,17,18,19,19,20,21,22,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,44,45,47,48,49,52,54,55,57,59,60,62,65,67,69,70,72,74,77,79,81,83,86,88,90,92,94,97,99,101,103,107,109,111,112,116,118,120,124,126,127,129,133,135,136,140,142,143,145,149,150,152,155,157,159,162,163,165,167,170,171,173,176,177,178,180,183,184,185,188,189,190,192,194,195,196,198,200,201,202,203,204,206,207,208,209,211,212,213,214,215,216,218,219,219,220,221,222,223,224,225,226,227,227,228,229,229,230,231,232,232,233,234,234,235,236,236,237,238,238,239,239,240,241,241,242,242,243,244,244,245,245,245,246,247,247,248,248,249,249,249,250,251,251,252,252,252,253,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],Sg=[0,0,1,2,2,3,5,5,6,7,8,8,10,11,11,12,13,15,15,16,17,18,18,19,21,22,22,23,24,26,26,27,28,29,31,31,32,33,34,35,35,37,38,39,40,41,43,44,44,45,46,47,48,50,51,52,53,54,56,57,58,59,60,61,63,64,65,66,67,68,69,71,72,73,74,75,76,77,79,80,81,83,84,85,86,88,89,90,92,93,94,95,96,97,100,101,102,103,105,106,107,108,109,111,113,114,115,117,118,119,120,122,123,124,126,127,128,129,131,132,133,135,136,137,138,140,141,142,144,145,146,148,149,150,151,153,154,155,157,158,159,160,162,163,164,166,167,168,169,171,172,173,174,175,176,177,178,179,181,182,183,184,186,186,187,188,189,190,192,193,194,195,195,196,197,199,200,201,202,202,203,204,205,206,207,208,208,209,210,211,212,213,214,214,215,216,217,218,219,219,220,221,222,223,223,224,225,226,226,227,228,228,229,230,231,232,232,232,233,234,235,235,236,236,237,238,238,239,239,240,240,241,242,242,242,243,244,245,245,246,246,247,247,248,249,249,249,250,251,251,252,252,252,253,254,255],Sb=[53,53,53,54,54,54,55,55,55,56,57,57,57,58,58,58,59,59,59,60,61,61,61,62,62,63,63,63,64,65,65,65,66,66,67,67,67,68,69,69,69,70,70,71,71,72,73,73,73,74,74,75,75,76,77,77,78,78,79,79,80,81,81,82,82,83,83,84,85,85,86,86,87,87,88,89,89,90,90,91,91,93,93,94,94,95,95,96,97,98,98,99,99,100,101,102,102,103,104,105,105,106,106,107,108,109,109,110,111,111,112,113,114,114,115,116,117,117,118,119,119,121,121,122,122,123,124,125,126,126,127,128,129,129,130,131,132,132,133,134,134,135,136,137,137,138,139,140,140,141,142,142,143,144,145,145,146,146,148,148,149,149,150,151,152,152,153,153,154,155,156,156,157,157,158,159,160,160,161,161,162,162,163,164,164,165,165,166,166,167,168,168,169,169,170,170,171,172,172,173,173,174,174,175,176,176,177,177,177,178,178,179,180,180,181,181,181,182,182,183,184,184,184,185,185,186,186,186,187,188,188,188,189,189,189,190,190,191,191,192,192,193,193,193,194,194,194,195,196,196,196,197,197,197,198,199],ROBES=["robe white","robe king","robe blue","robe red","toga"],PANTS=["lederhosen","nurse","overalls yellow","overalls blue","overalls flannel","overalls pink","overalls red","fishing waders grey","fishing waders green"],WOLFPANTS=["overalls skull","fishing waders grey","fishing waders green"],SHIRTS=["dueler","scarf plaid","scarf red","chain","necklace flint","necklace jaw","necklace teeth"],OVERSHIRTS=["pinstripe vest","dress"],FeetExemptFromHiding=["autumn leaf pile","snowman shoes","gift box bottom","gift pile"];function isShirtAccessory(trait){return trait.traitType===types.K3.SHIRT&&(["university-sweatshirt-coffee","snowman-body"].includes(trait.name?.toLowerCase().replace(" ","-"))||trait.name.includes("coffee"))}const effects={[types.df.EFFECT_BLACK_AND_WHITE]:(canvas,ctx,layer)=>{const imgData=ctx.getImageData(0,0,canvas.width,canvas.height),{data}=imgData;for(let i=0;i<data.length;i+=4){const med=(data[i]+data[i+1]+data[i+2])/3;data[i+0]=med,data[i+1]=med,data[i+2]=med}ctx.putImageData(imgData,0,0)},[types.df.EFFECT_OUTLINE]:(canvas,ctx,layer)=>EFFECT_OUTLINE_PARENT(canvas,ctx,[35],[31],[32]),[types.df.EFFECT_INVERSE]:(canvas,ctx,layer)=>{const imgData=ctx.getImageData(0,0,canvas.width,canvas.height),{data}=imgData;for(let i=0;i<data.length;i+=4)data[i+0]=255^data[i+0],data[i+1]=255^data[i+1],data[i+2]=255^data[i+2];ctx.putImageData(imgData,0,0)},[types.df.EFFECT_OUTLINE_LEFT_CAT]:(canvas,ctx,layer)=>{const bounds=Array.from(Array(10).keys()).map((i=>i+29));return EFFECT_OUTLINE_PARENT(canvas,ctx,bounds,bounds,bounds)},[types.df.EFFECT_STICKER]:(canvas,ctx,layer,createCanvas,index)=>{},[types.df.EFFECT_UPSIDE_DOWN]:(canvas,ctx,layer)=>{},[types.df.EFFECT_FLIP_HORIZONTAL]:(canvas,ctx,layer)=>{},[types.df.EFFECT_SEPIA]:(canvas,ctx,layer)=>{const imgData=ctx.getImageData(0,0,canvas.width,canvas.height),{data}=imgData;for(let i=0;i<data.length;i+=4){data[i+0]=Sr[data[i+0]],data[i+1]=Sg[data[i+1]],data[i+2]=Sb[data[i+2]];{const noise=Math.round(10-10*Math.random());for(let j=0;j<3;j++){const iPN=noise+data[i+j];data[i+j]=iPN>255?255:iPN}}}ctx.putImageData(imgData,0,0)}},mutations={[types.df.HIDE_VISOR]:(trait,traits)=>traits.find((t=>t.traitType===types.K3.FACE&&t.name.includes("tvface")))?{...trait,images:trait.images.filter((i=>!i.uri.includes("screen")))}:trait,[types.df.MOVE_PANTS_UNDER_SHIRT]:(trait,traits)=>trait.type===types.qE.CAT&&trait.traitType===types.K3.PANTS&&traits.find((t=>t.traitType===types.K3.SHIRT&&ROBES.includes(t.name.split("-").join(" ").toLowerCase())))?{...trait,weight:2}:trait,[types.df.MOVE_PANTS_OVER_SHIRT]:(trait,traits)=>trait.traitType===types.K3.PANTS&&(trait.type===types.qE.CAT&&PANTS.includes(trait.name.split("-").join(" ").toLowerCase())||trait.type===types.qE.EXPLORER&&PANTS.includes(trait.name.split("-").join(" ").toLowerCase())||trait.type===types.qE.SHADOWWOLF&&WOLFPANTS.includes(trait.name.split("-").join(" ").toLowerCase()))&&!traits.find((t=>t.traitType===types.K3.SHIRT&&ROBES.includes(t.name.split("-").join(" ").toLowerCase())))?{...trait,weight:4.5}:trait,[types.df.MOVE_SHIRTS_OVER_HATS]:(trait,traits)=>trait.traitType===types.K3.SHIRT&&SHIRTS.includes(trait.name.split("-").join(" ").toLowerCase())?{...trait,weight:6.5}:trait.traitType===types.K3.PANTS&&OVERSHIRTS.includes(trait.name.split("-").join(" ").toLowerCase())&&traits.find((t=>t.traitType===types.K3.SHIRT&&OVERSHIRTS.includes(t.name.split("-").join(" ").toLowerCase())))?{...trait,weight:4.5}:trait,[types.df.COMIC_CON_PLACEMENT]:(trait,traits,width,height,tokenId,type,view)=>trait.traitType===types.K3.BORDER||trait.traitType===types.K3.BACKGROUND?trait:view===types.IM.HEAD?{...trait,width:1.5*(width||2e3),height:1.5*(height||2e3),offsetX:-.09*width*(type===types.qE.CAT&&"500"===tokenId?-1:1),offsetY:.35*height*(type===types.qE.CAT&&"500"===tokenId?-1:1)}:{...trait,width:1*(width||2e3),height:1*(height||2e3),offsetX:.165*width*(type===types.qE.CAT&&"500"===tokenId?-1:1),offsetY:.4*height*(type===types.qE.CAT&&"500"===tokenId?-1:1)},[types.df.HOMER_NFT_PLACEMENT]:(trait,traits,width,height,tokenId,type,view)=>trait.traitType===types.K3.BORDER||trait.traitType===types.K3.BACKGROUND?trait:view===types.IM.HEAD?{...trait,width:.7*(width||2e3),height:.7*(height||2e3),offsetX:.4*width*(type===types.qE.CAT&&"500"===tokenId?-1:1),offsetY:.45*height*(type===types.qE.CAT&&"500"===tokenId?-1:1)}:{...trait,width:.25*(width||2e3),height:.25*(height||2e3),offsetX:.625*width*(type===types.qE.CAT&&"500"===tokenId?-1:1),offsetY:.46*height*(type===types.qE.CAT&&"500"===tokenId?-1:1)},[types.df.CHRISTMAS_CARD_PLACEMENT]:(trait,traits,width,height,tokenId,type)=>trait.traitType===types.K3.BORDER||trait.traitType===types.K3.BACKGROUND?trait:trait.traitType===types.K3.SIDEKICK?{...trait,weight:-1}:{...trait,width:1*(width||2e3),height:1*(height||2e3),offsetX:0*width*(type===types.qE.CAT&&"500"===tokenId?-1:1),offsetY:.3*height*(type===types.qE.CAT&&"500"===tokenId?-1:1)},[types.df.MILK_CHUG]:(trait,traits,width,height,tokenId,type,view)=>{if(trait.traitType===types.K3.BORDER||trait.traitType===types.K3.BACKGROUND)return trait;if(trait.traitType===types.K3.SIDEKICK||trait.traitType===types.K3.ACCESSORY||trait.traitType===types.K3.SHOES)return{...trait,weight:-1};return{...trait,images:trait.traitType===types.K3.BODY?trait.images.filter((i=>!["sw-feet.png","1-socks.png","2-socks.png"].includes(i.uri))):trait.images,offsetX:.045*width*(type===types.qE.CAT&&"500"===tokenId?-1:1),offsetY:.01*height*(type===types.qE.CAT&&"500"===tokenId?-1:1)}},[types.df.HIDE_FACE_FOR_MECHANICAL]:(trait,traits,width,height,tokenId,type)=>(trait.traitType===types.K3.FACE||trait.traitType===types.K3.SHOES&&trait.type===types.qE.SHADOWWOLF)&&traits.find((t=>t.traitType===types.K3.SKIN&&t.name.toLowerCase().includes("mechanical")))?{...trait,weight:-1}:trait,[types.df.WOOT_PLACEMENT]:(trait,traits,width,height,tokenId,type,view)=>[types.K3.BODY,types.K3.FACE,types.K3.HAT].includes(trait.traitType)?trait.traitType===types.K3.BORDER?{...trait,weight:0}:{...trait,width:1.2*(width||2e3),height:1.2*(height||2e3),offsetX:.135*width*(type===types.qE.CAT&&"500"===tokenId?-1:1),offsetY:.48*height*(type===types.qE.CAT&&"500"===tokenId?-1:1)}:{...trait,weight:-1},[types.df.HIDE_LEGS_AND_FEET]:(trait,traits,width,height,tokenId,type)=>trait.traitType!==types.K3.SHOES||FeetExemptFromHiding.includes(trait.name)?trait.traitType===types.K3.BODY?{...trait,images:trait.images.filter((i=>!i.uri.includes("body")&&!i.uri.includes("feet")&&!i.uri.includes("-socks")))}:trait:{...trait,weight:-1},[types.df.FLIP_ACCESSORY]:(trait,traits,width,height,tokenId,type)=>trait.traitType===types.K3.ACCESSORY&&traits.find(isShirtAccessory)?{...trait,rules:(trait.rules||[]).concat({fn:types.df.EFFECT_FLIP_HORIZONTAL,type:types.n6.EFFECT})}:trait,[types.df.FLIP_SIDEKICK]:(trait,traits,width,height,tokenId,type)=>trait.traitType===types.K3.SIDEKICK&&traits.find((t=>t.traitType===types.K3.ACCESSORY&&"no accessory"!==t.name))&&!traits.find(isShirtAccessory)?{...trait,rules:(trait.rules||[]).concat({fn:types.df.EFFECT_FLIP_HORIZONTAL,type:types.n6.EFFECT})}:trait,[types.df.HIDE_ARMS]:(trait,traits,width,height,tokenId,type)=>trait.traitType===types.K3.BODY&&traits.find(isShirtAccessory)?{...trait,images:trait.images.filter((i=>!i.uri.includes("arms")&&!i.uri.includes("gloves")))}:trait,[types.df.HIDE_CHEEKS]:(trait,traits,width,height,tokenId,type)=>trait.traitType===types.K3.BODY?{...trait,images:trait.images.filter((i=>"sw-cheeks.png"!==i.uri))}:trait,[types.df.CABAL_PLACEMENT]:(trait,traits,width,height,tokenId,type,view)=>trait.traitType===types.K3.BORDER||trait.traitType===types.K3.BACKGROUND?trait:trait.traitType===types.K3.HAT?{...trait,offsetX:-9999}:{...trait,background:type===types.qE.SHADOWWOLF&&trait.traitType===types.K3.BODY?"#231F20":"",width:1.9*(width||2e3),height:1.9*(height||2e3),offsetX:-.45*width*(type===types.qE.CAT&&"500"===tokenId?-1:1),offsetY:height*(type===types.qE.SHADOWWOLF?.04:.06)*(type===types.qE.CAT&&"500"===tokenId?-1:1)},[types.df.HAT_MUTATION]:(trait,traits)=>trait.traitType===types.K3.HAT&&trait.name.replace(/-/g," ").includes("bucket hat")&&traits.find((t=>t.traitType===types.K3.ACCESSORY&&t.name.replace(/-/g," ").includes("fishing vest")))?{...trait,weight:9}:trait},BODY_OVERRIDES=["CAT_2288_Skeleton","CAT_3330_Robot","CAT_4695_Lucky","CAT_500_Upsidedown","CAT_5280_Demon","CAT_6972_Celestial","CAT_8800_Angel","CAT_9580_Alien","CAT_1490_Zombie","SHADOWWOLF_3928_Blood Moon","SHADOWWOLF_4953_Poison Mushroom","SHADOWWOLF_5769_Blue Flame","SHADOWWOLF_6092_Lotus Flower","SHADOWWOLF_3572_Dark Star"],TIGERS=["6455","8968","1146","4687","6054","6250","2477","6688","526","1718","4960","6749","4717","4952","6169","6635","9607","9882","1544","3611","5843","6482","1180","1233","5416","7107","3772","4178","8645","8170","2980","3019","2172","2156","8579","1515","1977","7262","8815","611","6954","1279","6967","8084","5735","3623","5949","6705","3213","8969","6136","2179","7460","1451","9254","1785","5708","5617","4735","5249"],TRIBAL=["4687","4483","4734","4782","4932","4974","4975","4216","3979","1867","4406","4418","4369","4152","4050","4089","4075","5036","5120","5164","319","60","377","279","889","1500","1491","728","1146","607","960","658","1269","1249","830","1329","1609","1559","1801","1873","5019","5192","5184","5228","5521","5499","4976","5421","749","1509","5638","6007","6063","6165","6245","5750","5830","5842","5855","5911","312","1504","3612","3005","3059","3117","3146","3172","3184","3191","3322","3476","3491","3544","3568","3604","2306","2463","2581","2615","10","521","4271","4972"],SKELETON=["4668","4517","4802","4955","974","2132","4245","4336","2075","4277","1162","1735","4058","1354","5343","5518","5763","6033","6183","213","292","1927","1483","1113","1510","1724","747","1632","862","484","532","1093","1017","1200","1234","1356","1362","117","141","1431","3255","3296","3354","3448","3480","3482","3547","3559","2361","2428","2483","2612","2790","2907","3831","776","1834","1159","362"];function applyDefaultWeights(trait){return{...trait,weight:{[types.K3.BACKGROUND]:0,[types.K3.BACK]:.5,[types.K3.BODY]:1,[types.K3.SKIN]:1.5,[types.K3.PANTS]:2,[types.K3.SHOES]:3,[types.K3.SHIRT]:4,[types.K3.FACE]:5,[types.K3.HAT]:6,[types.K3.BORDER]:7,[types.K3.ACCESSORY]:8,[types.K3.SIDEKICK]:9,[types.K3.EFFECT]:100}[trait.traitType]}}function evaluateRule(rules,trait,traits,width,height,tokenId,type,view){let updatedTraits=traits;return rules.map((r=>{const fn=mutations[r.fn];if("function"==typeof fn){const updatedTrait=fn(trait,updatedTraits,width,height,tokenId,type,view);return updatedTraits=updatedTraits.filter((ut=>ut.id===updatedTrait.id?updatedTrait:ut)),updatedTrait}})).filter((r=>r)).reduce(((cur,i)=>({...cur,...i})),trait)}function createAvatarCanvasLayers(config){const{view,type,tokenId,traits,width,height,baseUrl}=config,LEGENDARY_OVERRIDE=BODY_OVERRIDES.find((o=>!!tokenId&&o.split("_").slice(0,2).join("_")===`${type||""}_${tokenId||""}`)),LEGENDARY_OVERRIDE_TRAIT={type:type||types.qE.CAT,view:types.IM.FULL,traitType:types.K3.BODY,name:(LEGENDARY_OVERRIDE||"___").split("_")[2],rarity:types.un.LEGENDARY,images:[{uri:`${(LEGENDARY_OVERRIDE||"___").split("_")[1]}.png`}],weight:type===types.qE.SHADOWWOLF?6.8:void 0,rules:[]},isUpsideDown="CAT_500_Upsidedown"===LEGENDARY_OVERRIDE,hasShirt=traits.find((t=>t.traitType===types.K3.SHIRT)),hasShoes=traits.find((t=>t.traitType===types.K3.SHOES&&"no shoes"!==t.name?.toLowerCase())),hasFace=traits.find((t=>t.traitType===types.K3.FACE&&"no face"!==t.name?.toLowerCase())),hasHat=traits.find((t=>t.traitType===types.K3.HAT&&"no hat"!==t.name?.toLowerCase())),hasBorder=traits.find((t=>t.traitType===types.K3.BORDER&&"no border"!==t.name?.toLowerCase())),isTiger="string"==typeof tokenId&&TIGERS.includes(tokenId)&&type===types.qE.CAT,isTribal="string"==typeof tokenId&&TRIBAL.includes(tokenId)&&type===types.qE.SHADOWWOLF,isSkeleton="string"==typeof tokenId&&SKELETON.includes(tokenId)&&type===types.qE.SHADOWWOLF,isSticker=void 0!==(traits.find((t=>t.traitType===types.K3.EFFECT))?.rules||[])?.find((r=>r.fn===types.df.EFFECT_STICKER))&&!hasBorder,isGhostTail=void 0!==traits.find((t=>t.traitType===types.K3.PANTS&&t.name.includes("ghost"))),bodyImages=function getBodyImages(type,view,traits,tokenId){const isTiger="string"==typeof tokenId&&TIGERS.includes(tokenId)&&type===types.qE.CAT,isTribal="string"==typeof tokenId&&TRIBAL.includes(tokenId)&&type===types.qE.SHADOWWOLF,isSkeleton="string"==typeof tokenId&&SKELETON.includes(tokenId)&&type===types.qE.SHADOWWOLF,hasBorder=traits.find((t=>t.traitType===types.K3.BORDER&&"no border"!==t.name?.toLowerCase())),frontImages=traits.filter((t=>t.name.toLowerCase().endsWith("front")&&t.images.length>0)).map((t=>({uri:t.images[0].uri.replace("front","back"),weight:0})));return[isTiger?{uri:"tiger.png",weight:100}:void 0].concat(isTribal?[{uri:"tribal.png",weight:100}]:void 0).concat(isSkeleton?[{uri:"skeleton.png",weight:100}]:void 0).concat(type===types.qE.CAT?[{uri:"cc-body.png",weight:1},{uri:"cc-arms.png",weight:2},{uri:"cc-head.png",weight:3},{uri:"cc-whiskers.png",weight:4}]:void 0).concat(type===types.qE.SHADOWWOLF?[{uri:"sw-feet.png",weight:1},{uri:"sw-body.png",weight:2},{uri:"sw-shoulders.png",weight:3},{uri:"sw-arms.png",weight:4},{uri:"sw-cheeks.png",weight:5},{uri:"sw-ears.png",weight:6},{uri:"sw-head.png",weight:7}]:void 0).concat(type===types.qE.EXPLORER?[{uri:("string"==typeof tokenId?`${tokenId}-`:"")+"socks.png",weight:5},{uri:("string"==typeof tokenId?`${tokenId}-`:"")+"body.png",weight:1},{uri:("string"==typeof tokenId?`${tokenId}-`:"")+"arms.png",weight:2},{uri:("string"==typeof tokenId?`${tokenId}-`:"")+"gloves.png",weight:3},{uri:("string"==typeof tokenId?`${tokenId}-`:"")+"head.png",weight:4},{uri:("string"==typeof tokenId?`${tokenId}-`:"")+"face.png",weight:5}]:void 0).concat(type===types.qE.NONE?[{uri:"body.png",weight:1}]:void 0).concat(frontImages).map(((b,i)=>hasBorder?b:view===types.IM.HEAD&&type===types.qE.CAT?0===i?{uri:"cc-chin.png",weight:0}:void 0:view===types.IM.HEAD&&type===types.qE.SHADOWWOLF?b?.uri?.includes("head")||b?.uri?.includes("cheeks")||b?.uri?.includes("ears")?b:void 0:view===types.IM.HEAD&&type===types.qE.EXPLORER?b?.uri?.includes("face")?b:0===i?{uri:("string"==typeof tokenId?`${tokenId}-`:"")+"chin.png",weight:0}:void 0:b)).filter((i=>i))}(type,view,traits,tokenId),body={type,view:types.IM.FULL,traitType:types.K3.BODY,name:"body",rarity:types.un.NONE,images:bodyImages,rules:[]},traitsIncludingBody=traits.concat([body]).filter((t=>hasBorder?t:t.traitType!==types.K3.BORDER)).map((t=>isSticker&&t.traitType===types.K3.EFFECT?{...t,images:[],rules:[]}:t)).map((t=>t.traitType===types.K3.BODY?{...t,images:LEGENDARY_OVERRIDE?LEGENDARY_OVERRIDE_TRAIT.images:t.images,weight:LEGENDARY_OVERRIDE?LEGENDARY_OVERRIDE_TRAIT.weight:t.weight}:t)).concat(LEGENDARY_OVERRIDE&&!traits.find((t=>t.traitType===types.K3.BACKGROUND))?[{...LEGENDARY_OVERRIDE_TRAIT,traitType:types.K3.BACKGROUND}]:[]).filter((t=>!(view===types.IM.HEAD&&!hasBorder)||[types.K3.HAT,types.K3.FACE,types.K3.BODY,types.K3.BACKGROUND,types.K3.EFFECT,types.K3.BORDER].includes(t.traitType))).map((t=>type!==types.qE.CAT||"500"!==tokenId||[types.K3.BACKGROUND,types.K3.BODY].includes(t.traitType)?t:{...t,rules:[{fn:types.df.EFFECT_UPSIDE_DOWN,type:types.n6.EFFECT}].concat(t.rules||[])})).map((t=>type===types.qE.CAT&&t.traitType===types.K3.BODY?{...t,images:(t.images||[]).filter((img=>!hasHat||"cc-whiskers.png"!==img.uri))}:t)).map((t=>type===types.qE.EXPLORER&&t.traitType===types.K3.BODY?{...t,images:(t.images||[]).filter((img=>!hasFace||!img.uri.includes("-face.png")))}:t)).reduce(((traits,trait)=>traits.concat([trait]).concat(trait?.subTraits?[...trait.subTraits]:[])),[]).map((t=>{if(type===types.qE.SHADOWWOLF&&t.traitType===types.K3.BODY){const invalids=[];return hasShirt&&invalids.push("sw-shoulders.png"),hasHat&&invalids.push("sw-ears.png"),hasShoes&&invalids.push("sw-feet.png"),{...t,images:(t.images||[]).filter((img=>!invalids.includes(img.uri)))}}return t}));let evaldTraits=traitsIncludingBody;evaldTraits.reduce(((rules,trait)=>rules.concat((trait?.rules||[]).filter((r=>r.type===types.n6.MUTATE_ALL)))),[]).forEach((r=>{evaldTraits=evaldTraits.map((t=>evaluateRule([r],t,evaldTraits,width||1e3,height||1e3,tokenId,type,view)))}));const sortedTraits=evaldTraits.map((trait=>({...trait,rules:(trait.rules||[]).concat(trait.traitType===types.K3.PANTS?[{fn:types.df.MOVE_PANTS_OVER_SHIRT,type:types.n6.MUTATE},{fn:types.df.MOVE_PANTS_UNDER_SHIRT,type:types.n6.MUTATE}]:[]).concat(trait.traitType===types.K3.SHIRT&&type===types.qE.SHADOWWOLF?[{fn:types.df.MOVE_SHIRTS_OVER_HATS,type:types.n6.MUTATE}]:[]).concat(trait.traitType===types.K3.BODY?[{fn:types.df.HIDE_ARMS,type:types.n6.MUTATE}]:[]).concat(trait.traitType===types.K3.ACCESSORY?[{fn:types.df.FLIP_ACCESSORY,type:types.n6.MUTATE}]:[]).concat(trait.traitType===types.K3.SIDEKICK?[{fn:types.df.FLIP_SIDEKICK,type:types.n6.MUTATE}]:[]).concat(trait.traitType===types.K3.HAT?[{fn:types.df.HAT_MUTATION,type:types.n6.MUTATE}]:[])}))).map((trait=>function evaluateTraitMutateRules(trait,traits,width,height){return evaluateRule((trait.rules||[]).filter((r=>r.type===types.n6.MUTATE)),trait,traits,width,height)}(trait,traits,width||1e3,height||1e3))).filter((t=>view!==types.IM.FRONT||t.traitType!==types.K3.SIDEKICK)).map((trait=>view===types.IM.FRONT&&trait.traitType!==types.K3.BACKGROUND&&trait.traitType!==types.K3.BORDER&&"number"!=typeof trait.offsetX?{...trait,offsetY:isUpsideDown?-1.1*(height||1e3):0,offsetX:-1*(width||1e3)/2,width:2*(width||1e3),height:2*(height||1e3)}:view!==types.IM.HEAD||hasBorder||[types.K3.BACKGROUND,types.K3.BORDER].includes(trait.traitType)||"number"==typeof trait.offsetX?trait:{...trait,offsetY:isUpsideDown?-1.1*(height||1e3):.05*(height||1e3),offsetX:-1*(width||1e3)/1.67,width:2.2*(width||1e3),height:2.2*(height||1e3)})).sort(((a,b)=>function applyWeights(traitA,traitB){return("number"==typeof traitA.weight?traitA.weight:applyDefaultWeights(traitA).weight)-("number"==typeof traitB.weight?traitB.weight:applyDefaultWeights(traitB).weight)}(a,b)));return sortedTraits.reduce(((layers,trait)=>{const canvasEffects=traits.filter((i=>i.traitType===types.K3.EFFECT)).reduce(((traitEffects,trait)=>{const funcs=(trait.rules||[]).filter((r=>r.type===types.n6.EFFECT&&"function"==typeof effects[r?.fn||""])).map((tr=>effects[tr?.fn||""]));return traitEffects.concat(funcs)}),[]).concat(trait.traitType!==types.K3.EFFECT?(trait.rules||[]).filter((r=>r.type===types.n6.EFFECT)).map((e=>effects[e.fn])):[]),newLayer=trait.images.sort(((a,b)=>(a?.weight||0)-(b?.weight||0))).reduce(((newLayers,traitImage)=>{const h=trait.height||height||1e3,w=trait.width||width||1e3;let cropY,src=trait.generated;return src||(src=traitImage.uri.startsWith("https")?traitImage.uri:`${(baseUrl||"").replace("$type",type.toLowerCase()).replace("$traitType",trait.traitType.toLowerCase())}${traitImage.uri}`),isGhostTail&&((isTiger||isSkeleton||isTribal)&&100===traitImage.weight||trait.traitType===types.K3.SKIN)&&(cropY=.64),newLayers.concat([{src,height:h,width:w,x:"number"==typeof trait.offsetX?trait.offsetX:0,y:"number"==typeof trait.offsetY?trait.offsetY:0,canvasCallbacks:canvasEffects,rotate:(trait.rules||[]).find((r=>r.fn===types.df.EFFECT_UPSIDE_DOWN))?180:void 0,flip:(trait.rules||[]).find((r=>r.fn===types.df.EFFECT_FLIP_HORIZONTAL))?"horizontal":void 0,stickerSpecial:isSticker,background:trait.background,parentBackground:trait.parentBackground,stickerExempt:trait.traitType===types.K3.BORDER,stickerWidth:view===types.IM.FULL?.01:.02,label:trait.traitType,cropY}])}),[]);return layers.concat(newLayer)}),[])}var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const AvatarCanvas=(0,react.forwardRef)(((props,ref)=>{const{traits,height,children,reset,bordered,width,view,baseUrl,type,tokenId,crossHairs,onLoadLayers}=props,[stateView,setStateView]=(0,react.useState)(view),[stateTokenId,setStateTokenId]=(0,react.useState)(tokenId||"");return(0,react.useEffect)((()=>{view&&setStateView(view)}),[view]),(0,react.useEffect)((()=>{tokenId&&setStateTokenId(tokenId)}),[tokenId]),(0,jsx_runtime.jsx)(LayeredCanvas.Z,{width,height,reset:reset||view!==stateView,ref,bordered,children,crossHairs,onLoadLayers,layers:createAvatarCanvasLayers({view:stateView,type,tokenId:stateTokenId,traits,height,width,baseUrl})})})),src_AvatarCanvas=AvatarCanvas;try{AvatarCanvas.displayName="AvatarCanvas",AvatarCanvas.__docgenInfo={description:"",displayName:"AvatarCanvas",props:{view:{defaultValue:null,description:"",name:"view",required:!0,type:{name:"enum",value:[{value:'"FRONT"'},{value:'"RIGHT"'},{value:'"FULL"'},{value:'"LEFT"'},{value:'"HEAD"'}]}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"CAT"'},{value:'"SHADOWWOLF"'},{value:'"EXPLORER"'},{value:'"NONE"'}]}},tokenId:{defaultValue:null,description:"",name:"tokenId",required:!1,type:{name:"string"}},traits:{defaultValue:null,description:"",name:"traits",required:!0,type:{name:"Trait[]"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"number"}},height:{defaultValue:null,description:"",name:"height",required:!1,type:{name:"number"}},baseUrl:{defaultValue:null,description:"",name:"baseUrl",required:!1,type:{name:"string"}},createCanvas:{defaultValue:null,description:"",name:"createCanvas",required:!0,type:{name:"Function"}},canvas:{defaultValue:null,description:"",name:"canvas",required:!1,type:{name:"HTMLCanvasElement"}},imageLoader:{defaultValue:null,description:"",name:"imageLoader",required:!1,type:{name:"Function"}},debug:{defaultValue:null,description:"",name:"debug",required:!1,type:{name:"boolean"}},reset:{defaultValue:null,description:"",name:"reset",required:!1,type:{name:"boolean"}},bordered:{defaultValue:null,description:"",name:"bordered",required:!1,type:{name:"boolean"}},background:{defaultValue:null,description:"",name:"background",required:!1,type:{name:"string"}},crossHairs:{defaultValue:null,description:"",name:"crossHairs",required:!1,type:{name:"boolean"}},onLoadLayers:{defaultValue:null,description:"",name:"onLoadLayers",required:!1,type:{name:"Function"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/AvatarCanvas/index.tsx#AvatarCanvas"]={docgenInfo:AvatarCanvas.__docgenInfo,name:"AvatarCanvas",path:"src/AvatarCanvas/index.tsx#AvatarCanvas"})}catch(__react_docgen_typescript_loader_error){}},"./src/LayeredCanvas/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>src_LayeredCanvas});var react=__webpack_require__("./node_modules/react/index.js");const imgCache={};const drawImageWrapper=(ctx,src,x,y,width,height,cropX,cropY)=>{try{const w=width||ctx?.canvas?.width||1e3,h=height||ctx?.canvas?.height||1e3;if(cropX||cropY){const sourceX=0,sourceY=0,sourceWidth=src?.width*(cropX||1),sourceHeight=src?.height*(cropY||1),destX=0,destY=0,destWidth=w*(cropX||1),destHeight=h*(cropY||1);ctx.drawImage(src,sourceX,sourceY,sourceWidth,sourceHeight,destX,destY,destWidth,destHeight)}else ctx.drawImage(src,x||0,y||0,w,h)}catch(e){console.error(`Error drawing ${src?.src} onto canvas`)}},fillRectWrapper=(ctx,x,y,width,height)=>{ctx.fillRect(x||0,y||0,width||ctx.canvas?.width||1e3,height||ctx.canvas?.height||1e3)},imageUrlToBase64=async url=>(async url=>fetch(url,{mode:"cors"}).then((response=>response.blob())))(url).then((blob=>(blob=>new Promise(((onSuccess,onError)=>{try{const reader=new FileReader;reader.onload=result=>{onSuccess(result?.target?.result)},reader.readAsDataURL(blob)}catch(e){onError(e)}})))(blob)));const applyStickerEffect=(canvasCreate,layerCanvas,stickerWidth)=>{const thickness=((width,stickerWidth)=>width*(stickerWidth||.02))(layerCanvas.width,stickerWidth),x=thickness+1,y=thickness+1,stickerCanv=canvasCreate(layerCanvas.width+2*x,layerCanvas.height+2*y),stickerCtx=stickerCanv.getContext("2d");for(let angle=0;angle<360;angle+=10)drawImageWrapper(stickerCtx,layerCanvas,thickness*Math.sin(2*Math.PI*angle/360)+x,thickness*Math.cos(2*Math.PI*angle/360));return stickerCtx.globalCompositeOperation="source-in",stickerCtx.fillStyle="white",fillRectWrapper(stickerCtx,0,0,stickerCanv.width,stickerCanv.height),stickerCtx.globalCompositeOperation="source-over",drawImageWrapper(stickerCtx,layerCanvas,x,0),stickerCanv.thickness=thickness,stickerCanv},generateLayeredCanvas=(config,canvas,createCanvas)=>{const{width,height,layers,debug,background,crossHairs}=config,parentBackground=layers.find((l=>l.parentBackground)),stickerEffect=layers.find((l=>l.stickerSpecial)),renderedLayers=[],canvasCreate=createCanvas||function(w,h){const canv=document.createElement("canvas");return canv.width=w,canv.height=h,canv},layeredCanvas=canvas||canvasCreate(width,height),ctx=layeredCanvas.getContext("2d");if(ctx.clearRect(0,0,width,height),(background||parentBackground)&&(ctx.fillStyle=background||parentBackground?.parentBackground,fillRectWrapper(ctx,0,0,width,height)),layers.forEach(((l,index)=>{const lWidth=l.width||width,lHeight=l.height||height,layerCanvas=canvasCreate(lWidth,lHeight),layerCtx=layerCanvas.getContext("2d",{willReadFrequently:!0});l.rotate&&(layerCtx.translate(lWidth/2,lHeight/2),layerCtx.rotate(-l.rotate*Math.PI/l.rotate),layerCtx.translate(-lWidth/2,-lHeight/2)),"horizontal"===l.flip&&(layerCtx.translate(lWidth,0),layerCtx.scale(-1,1)),l.transform&&layerCtx.transform(l.transform[0],l.transform[1],l.transform[2],l.transform[3],l.transform[4],l.transform[5]);const bg=debug?"blue":l.background||"";if(bg&&"inherit"!==bg&&(layerCtx.fillStyle=debug?"blue":l.background||"",fillRectWrapper(layerCtx,0,0,layerCanvas.width,layerCanvas.height)),void 0!==l.src)if(!0===l.transparent||"inherit"===l.background){const tokenCanv=canvasCreate(layerCanvas.width,layerCanvas.height),tokenCtx=tokenCanv.getContext("2d",{willReadFrequently:!0});drawImageWrapper(tokenCtx,l.src,0,0,layerCanvas.width,layerCanvas.height);const pixelData=tokenCtx.getImageData(0,0,1,1).data,imageData=tokenCtx.getImageData(0,0,lWidth,lHeight),hexBg=(arrayBuffer=pixelData,Array.prototype.map.call(new Uint8Array(arrayBuffer),(n=>n.toString(16).padStart(2,"0"))).join("")),shortendHexBg=hexBg.substring(0,hexBg.length-2).toLowerCase();if("inherit"===l.background){const bgCanvas=canvasCreate(width,height),bgCtx=bgCanvas.getContext("2d");bgCtx.fillStyle=`#${shortendHexBg}`,fillRectWrapper(bgCtx,0,0,width,height),drawImageWrapper(ctx,bgCanvas,0,0,bgCanvas.width,bgCanvas.height)}if(!0===l.transparent){for(let i=0;i<imageData.data.length;i+=4){const red=imageData.data[i],green=imageData.data[i+1],blue=imageData.data[i+2];red==pixelData[0]&&green==pixelData[1]&&blue==pixelData[2]&&(imageData.data[i+3]=0)}tokenCtx.putImageData(imageData,0,0)}drawImageWrapper(layerCtx,tokenCanv,0,0,layerCanvas.width,layerCanvas.height)}else l.src&&drawImageWrapper(layerCtx,l.src,0,0,layerCanvas.width,layerCanvas.height,l.cropX,l.cropY);else if(void 0!==l.text){let sentence=(l.textCallback?l.textCallback:t=>t)(l.text||"");const{maxLimit,color,shadow,minFontSize,maxFontSize,font}=l;maxLimit&&sentence.length>=maxLimit&&(sentence=sentence.slice(0,maxLimit-3).trim().concat("..."));const tempCanvas=canvasCreate(layerCanvas.width,layerCanvas.height),tempCtx=tempCanvas.getContext("2d");tempCtx.textAlign="center",tempCtx.fillStyle=color||"#fff",shadow&&(tempCtx.shadowColor="black",tempCtx.shadowBlur=4,tempCtx.lineWidth=2),function drawMultilineText(ctx,text,options){let opts=options;opts||(opts={}),opts.font||(opts.font="sans-serif"),opts.rect||(opts.rect={x:0,y:0,width:ctx.canvas.width,height:ctx.canvas.height}),opts.lineHeight||(opts.lineHeight=1.1),opts.minFontSize||(opts.minFontSize=30),opts.maxFontSize||(opts.maxFontSize=100);const words=text.split(" ");let y,fontSize,lastFittingFont,lines=[],lastFittingLines=[],lastFittingY=1,lastFittingLineHeight=1;for(fontSize=opts.minFontSize;fontSize<=opts.maxFontSize;fontSize+=1){const lineHeight=fontSize*opts.lineHeight;ctx.font=`${fontSize}px ${opts.font}`;const{x}=opts.rect;y=lineHeight,lines=[];let line="";if(words.length>1)for(const word of words){const linePlus=`${line}${word} `;ctx.measureText(linePlus).width>=opts.rect.width?(lines.push({text:line,x,y}),line=`${word} `,y+=lineHeight):line=linePlus}else line=words.join("");if(ctx.measureText(line).width>opts.rect.width)break;if(lines.push({text:line,x,y}),y>opts.rect.height)break;lastFittingLines=lines,lastFittingFont=ctx.font,lastFittingY=y,lastFittingLineHeight=lineHeight}lines=lastFittingLines,ctx.font=lastFittingFont||options.font;const offset=opts.rect.y-lastFittingLineHeight/4+(opts.rect.height-lastFittingY)/2;for(const line of lines){let l=line.text.trim();if(ctx.measureText(l).width>opts.rect.width)for(;ctx.measureText(l).width>opts.rect.width;){const a=l.split("");a.pop(),l=a.join("")}ctx.fillText(l,line.x+opts.rect.width/2,line.y+offset)}return fontSize}(tempCtx,sentence,{minFontSize:minFontSize||20,maxFontSize:maxFontSize||300,font:font||void 0}),drawImageWrapper(tempCtx,tempCanvas,0,0,tempCanvas.width,tempCanvas.height),drawImageWrapper(layerCtx,tempCanvas,0,0,tempCanvas.width,tempCanvas.height)}var arrayBuffer;if(l.canvasCallbacks&&l.canvasCallbacks.length>0&&l.canvasCallbacks.forEach((effect=>{effect(layerCanvas,layerCtx,l,canvasCreate,index)})),l.sticker){const stickerCanv=applyStickerEffect(canvasCreate,layerCanvas,l.stickerWidth);renderedLayers.push({canvas:stickerCanv,x:l.x||0,y:l.y||0,width:layerCanvas.width,height:layerCanvas.height,stickerExempt:l.stickerExempt||!1,stickerWidth:l.stickerWidth,label:l.label})}else renderedLayers.push({canvas:layerCanvas,x:l.x||0,y:l.y||0,width:layerCanvas.width,height:layerCanvas.height,stickerExempt:l.stickerExempt||!1,stickerWidth:l.stickerWidth,label:l.label})})),stickerEffect){const hasBg=renderedLayers.find((l=>"BACKGROUND"===l.label));hasBg&&drawImageWrapper(ctx,hasBg.canvas,hasBg.x,hasBg.y,hasBg.width,hasBg.height);const forground=canvasCreate(width,height),forgroundCtx=forground.getContext("2d");renderedLayers.forEach((r=>{["BACKGROUND","EFFECT"].includes(r?.label||"")||drawImageWrapper(forgroundCtx,r.canvas,r.x,r.y,r.width,r.height)}));const stickerCanv=applyStickerEffect(canvasCreate,forground,renderedLayers[0]?.stickerWidth);drawImageWrapper(ctx,stickerCanv,-1*stickerCanv.thickness,0,width+stickerCanv.thickness,height),renderedLayers.filter((l=>l.stickerExempt)).forEach((r=>{drawImageWrapper(ctx,r.canvas,r.x,r.y,r.width,r.height)}))}else renderedLayers.forEach((r=>{drawImageWrapper(ctx,r.canvas,r.x,r.y,r.width,r.height)}));if(renderedLayers.forEach((r=>{r.canvas})),crossHairs){ctx.strokeStyle="red",ctx.lineWidth=3,ctx.beginPath(),ctx.moveTo(0,0),ctx.lineTo(canvas?.height,canvas?.width),ctx.stroke(),ctx.beginPath(),ctx.moveTo(0,canvas?.width),ctx.lineTo(canvas?.height,0),ctx.stroke(),ctx.beginPath(),ctx.moveTo((canvas?.width||0)/2,0),ctx.lineTo((canvas?.width||0)/2,canvas?.height),ctx.stroke(),ctx.beginPath(),ctx.moveTo(0,(canvas?.height||0)/2),ctx.lineTo(canvas?.width,(canvas?.height||0)/2),ctx.stroke();const centerX=(canvas?.width||0)/2,centerY=(canvas?.height||0)/2,radius=(canvas?.height||0)/2;ctx.beginPath(),ctx.arc(centerX,centerY,radius,0,2*Math.PI,!1),ctx.stroke()}return layeredCanvas};var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const LayeredCanvas=(0,react.forwardRef)(((props,ref)=>{const[layers,setLayers]=(0,react.useState)([]),canvasRef=(0,react.useRef)(null),{layers:propsLayers,height,children,reset,width,onLoadLayers}=props;return(0,react.useEffect)((()=>{reset?setLayers([]):Promise.all(propsLayers.map((l=>"string"==typeof l.src?function resolveImage(src){if(imgCache[src]){const img=new Image;return img.crossOrigin="Anonymous",img.src=imgCache[src],Promise.resolve(img)}return new Promise(((resolve,reject)=>imageUrlToBase64(src).then((dUri=>{const img=new Image;img.crossOrigin="Anonymous",img.src=dUri,imgCache[src]=dUri,resolve(img)})).catch(reject)))}(l.src).then((img=>({...l,src:img}))):Promise.resolve(l)))).then((newLayers=>{setLayers(newLayers),newLayers?.length>0&&onLoadLayers&&onLoadLayers(newLayers)}))}),[propsLayers,reset]),(0,react.useEffect)((()=>{(ref?.current||canvasRef?.current)&&generateLayeredCanvas({...props,layers},ref?.current||canvasRef?.current)}),[layers,props,ref,canvasRef]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!reset&&(0,jsx_runtime.jsx)("canvas",{height,width,ref:ref||canvasRef}),children||null]})})),src_LayeredCanvas=LayeredCanvas;try{LayeredCanvas.displayName="LayeredCanvas",LayeredCanvas.__docgenInfo={description:"",displayName:"LayeredCanvas",props:{height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"number"}},width:{defaultValue:null,description:"",name:"width",required:!0,type:{name:"number"}},debug:{defaultValue:null,description:"",name:"debug",required:!1,type:{name:"boolean"}},reset:{defaultValue:null,description:"",name:"reset",required:!1,type:{name:"boolean"}},bordered:{defaultValue:null,description:"",name:"bordered",required:!1,type:{name:"boolean"}},background:{defaultValue:null,description:"",name:"background",required:!1,type:{name:"string"}},crossHairs:{defaultValue:null,description:"",name:"crossHairs",required:!1,type:{name:"boolean"}},onLoadLayers:{defaultValue:null,description:"",name:"onLoadLayers",required:!1,type:{name:"Function"}},layers:{defaultValue:null,description:"",name:"layers",required:!0,type:{name:"CanvasLayer[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/LayeredCanvas/index.tsx#LayeredCanvas"]={docgenInfo:LayeredCanvas.__docgenInfo,name:"LayeredCanvas",path:"src/LayeredCanvas/index.tsx#LayeredCanvas"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/react/cjs/react-jsx-runtime.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{var f=__webpack_require__("./node_modules/react/index.js"),k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(c,a,g){var b,d={},e=null,h=null;for(b in void 0!==g&&(e=""+g),void 0!==a.key&&(e=""+a.key),void 0!==a.ref&&(h=a.ref),a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l,exports.jsx=q,exports.jsxs=q},"./node_modules/react/jsx-runtime.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/react/cjs/react-jsx-runtime.production.min.js")}}]);